window.onload=()=>{const o={exit:{main:"Do you really want to go to the menu?",sub:"Your current points are not saved"},restart:{main:"Do you really want to start over?",sub:"Your current points are not saved"},gameover:{main:"GAME OVER",sub:"Want to start over?"},bestgameover:{main:"GAME OVER. BEST SCORE!",sub:"Want to start over?"}},r=()=>{const e=document.createElement("a");e.href="main.html",e.click()},c=()=>{const e=document.createElement("a");e.href="tetris.html",e.click()},i=configuration.TETRISHEIGHT,t=document.getElementById("game");let l=configuration.GRIDSIZE;const a=t.getContext("2d"),e=document.getElementById("next"),s=e.getContext("2d");function n(e){p=!0,cancelAnimationFrame(R);const t=document.querySelector(".gameover"),n=document.querySelector(".gameover__actions");t.children[0].textContent=o[e].main,t.children[1].textContent=o[e].sub,"exit"===e&&(n.children[0].onclick=r,n.children[1].onclick=_),"restart"===e&&(n.children[0].onclick=c,n.children[1].onclick=_),"gameover"!==e&&"bestgameover"!==e||(n.children[0].onclick=c,n.children[1].onclick=r,t.classList.add("bold")),n.children[0].addEventListener("click",()=>{t.classList.remove("show"),t.classList.remove("bold")}),n.children[1].addEventListener("click",()=>{t.classList.remove("show"),t.classList.remove("bold")}),t.classList.add("show")}const m=document.getElementById("actions");function d(){t.height=i*l,t.width=10*l;const e=document.querySelector(".gameover");e.style.width="569px"}m.children[0].onclick=e=>{n("restart")},m.children[1].onclick=e=>{n("exit")},d();var u=[],h=[];for(let t=-2;t<i;t++){h[t]=[];for(let e=0;e<10;e++)h[t][e]=0}const f={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]],O:[[1,1],[1,1]],S:[[0,1,1],[1,1,0],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]],T:[[0,1,0],[1,1,1],[0,0,0]]},g={I:"#e20e0e",O:"#e28166",T:"#4b57f2",S:"#069c93",Z:"#5a9c06",J:"#a90ee2",L:"#e2810e"},E=configuration.COUNTTOCHANGE;let v=0,S=0,w=0,y=1,A=0,I="",O="",T=0,b=!1,x=!1;setTimeout(()=>{b=!0,x=!0},configuration.EXPECTATION);let L=B(),R=null,N=!1,p=!1;function M(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function k(e,t){t&&y++;let n=["I","J","L","O","S","T","Z"];"NEUTRAL"===e?n=["S","Z"]:"NEGATIVE"===e&&(n=["I"]);e=M(0,n.length-1),e=n.slice(e,e+1)[0];u.push(e)}function D(e){switch(e||I){case"H":case"U":return"POSITIVE";case"N":case"G":return"NEUTRAL";case"A":case"D":case"S":return"NEGATIVE"}}function G(){const e=document.getElementById("emotion");I&&(e.innerHTML=`<div>Emotion:<br />${{H:"Happy",U:"Wonder",N:"OK",G:"Sad",A:"Angry",D:"Disgust",S:"Scared"}[I]}<div>`);const t=document.getElementById("score");t.innerHTML="Score:<br />"+A;const n=document.getElementById("level");n.innerHTML="Level:<br />"+y;const o=document.getElementById("lines");o.innerHTML="Lines:<br />"+w}function H(){var e=["H","U","N","G","A","D","S"];return e[M(0,e.length-1)]}function C(){if(s.clearRect(0,0,e.width,e.height),u&&0<u.length&&u[u.length-1]){s.fillStyle=g[u[u.length-1]];var n=f[u[u.length-1]];for(let t=0;t<4;t++)for(let e=0;e<4;e++)n[t]&&n[t][e]&&s.fillRect(e*l,t*l,l-1,l-1)}}function B(){if(0===u.length){let e=!1;v>=E&&(t=O,I=H(),O=D(),v=0,e=t===O),k(O,e),G()}var t=u.pop();if(0===u.length){x&&w&&v++;let e=!1;(v>=E||b&&w)&&(n=O,I=H(),O=D(),v=0,e=n===O,b=!1),k(O,e),G(),C()}var n=f[t];return{name:t,matrix:n,row:"I"===t?-1:-2,col:h[0].length/2-Math.ceil(n[0].length/2)}}function F(n,o,r){for(let t=0;t<n.length;t++)for(let e=0;e<n[t].length;e++)if(n[t][e]&&(r+e<0||r+e>=h[0].length||o+t>=h.length||h[o+t][r+e]))return;return 1}function q(){for(let t=0;t<L.matrix.length;t++)for(let e=0;e<L.matrix[t].length;e++)if(L.matrix[t][e]){if(L.row+t<=0)return function(){cancelAnimationFrame(R),N=!0;let e=localStorage.getItem("scores");e=e?JSON.parse(e):{};A&&(e[A.toString()]=(new Date).valueOf(),localStorage.setItem("scores",JSON.stringify(e)));n("gameover")}(),0;h[L.row+t][L.col+e]=L.name}let t=0;for(let e=h.length-1;0<=e;)if(h[e].every(e=>!!e)){t++;for(let t=e;0<=t;t--)for(let e=0;e<h[t].length;e++)h[t][e]=h[t-1][e]}else e--;if(S+=t,w+=t,A+100>=Number.MAX_SAFE_INTEGER){let e=localStorage.getItem("scores");e=e?JSON.parse(e):{},A&&(e[Number.MAX_SAFE_INTEGER]=(new Date).valueOf(),localStorage.setItem("scores",JSON.stringify(e))),function(){cancelAnimationFrame(R);const t=document.querySelector("body");t.style.display="flex",t.style.alignItems="center",Array.from(t.children).map(e=>{t.removeChild(e)});const e=document.createElement("div");t.appendChild(e),e.innerHTML='<b>OOPS!</b><br />ERROR! GAMER DETECTED!<br />STOP PLAYING AND DO YOUR HOMEWORK!<br />(MAX SCORE REACHED)<br /><button id="error">OK</button>',e.style.textAlign="center",e.style.fontSize="30px",e.onclick=r}()}1===t?A+=100:2===t?A+=300:3===t?A+=700:4===t&&(A+=1e3),10<=S&&(y++,S-=10),G(),L=B()}function J(){a.clearRect(0,0,t.width,t.height);for(let t=0;t<i;t++)for(let e=0;e<10;e++){var n;h[t][e]&&(n=h[t][e],a.fillStyle=g[n],a.fillRect(e*l,t*l,l-1,l-1))}if(L){++T>36-y&&(L.row++,T=0,F(L.matrix,L.row,L.col)||(L.row--,q())),a.fillStyle=g[L.name];for(let t=0;t<L.matrix.length;t++)for(let e=0;e<L.matrix[t].length;e++)L.matrix[t][e]&&a.fillRect((L.col+e)*l,(L.row+t)*l,l-1,l-1)}}function U(){R=requestAnimationFrame(U),J()}function _(){p=!1,R=requestAnimationFrame(U)}G(),document.addEventListener("keydown",function(e){var t;if(!N&&(37!==e.which&&39!==e.which||(t=37===e.which?L.col-1:L.col+1,F(L.matrix,L.row,t)&&(L.col=t)),38!==e.which||F(t=function(o){const r=o.length-1;return o.map((e,n)=>e.map((e,t)=>o[r-t][n]))}(L.matrix),L.row,L.col)&&(L.matrix=t),40===e.which)){e=L.row+1;if(!F(L.matrix,e,L.col))return L.row=e-1,void q();L.row=e}}),R=requestAnimationFrame(U),document.addEventListener("keydown",function(e){"Escape"===e.code&&n("exit"),"KeyR"===e.code&&n("restart")}),window.addEventListener("resize",()=>{d(),C(),J()})};